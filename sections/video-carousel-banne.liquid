<section class="video-carousel-banner {{ section.settings.custom_class }}" style="background-image:url('{{ section.settings.bg_image | img_url: 'master' }}');">
  
  <!-- Flickity CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flickity/2.3.0/flickity.min.css"/>


  <div class="full-width">
    <div class="video-layout">

      <!-- LEFT CONTENT -->
      <div class="video-left">
        {% if section.settings.subheading %}
          <p class="video-sub">{{ section.settings.subheading }}</p>
        {% endif %}
        {% if section.settings.heading %}
          <h2 class="video-title">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.description %}
          <p class="video-desc">{{ section.settings.description }}</p>
        {% endif %}

      </div>

      <!-- RIGHT CAROUSEL -->
      <div class="video-right">
        <div class="video-carousel js-flickity"        >

          {% for block in section.blocks %}
            <div class="video-card">
              
              <div class="video-thumb-wrap">
                {% if block.settings.video_file != blank %}
                    <video src="{{ block.settings.video_file.sources[0].url }}"></video>
                {% endif %}

                <button class="video-play" data-video="{{ block.settings.video_file.sources[0].url }}">▶</button>
              </div>

              <div class="video-info">
                <h4>{{ block.settings.title }}</h4>
                <p>{{ block.settings.description }}</p>
              </div>

            </div>
          {% endfor %}

        </div>
      </div>

    </div>
  </div>

  <!-- Popup -->
  <div class="video-popup-overlay">
    <div class="video-popup-box">
        <button class="video-close">×</button>

        <video id="popupVideo" controls playsinline>
        <source src="" type="video/mp4">
        </video>
    </div>
    </div>
</section>


{% style %}
.video-carousel-banner {
  position: relative;
  background: {{ section.settings.bg_color }};
  padding-top: {{ section.settings.padding_top_desktop }}px;
  padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
  overflow: hidden;
  background-size: auto;
  background-repeat: no-repeat;
}

@media (max-width: 768px) {
  .video-carousel-banner {
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }
}


{% endstyle %}

<!-- Flickity JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/flickity/2.3.0/flickity.pkgd.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var videoSlider = document.querySelector(".video-carousel");

  if (videoSlider) {
    new Flickity(videoSlider, {
      cellAlign: "left",
      contain: true,
      groupCells: 2,
      wrapAround: true,
      pageDots: true,
      prevNextButtons: true
    });
  }
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {

  const popup = document.querySelector(".video-popup-overlay");
  const popupVideo = document.getElementById("popupVideo");
  const closeBtn = document.querySelector(".video-close");

  document.querySelectorAll(".video-play").forEach(btn => {
    btn.addEventListener("click", function() {
      let url = this.dataset.video;

      if (!url) return;

      popup.style.display = "flex";
      popupVideo.querySelector("source").src = url;
      popupVideo.load();
      popupVideo.play();
    });
  });

  closeBtn.addEventListener("click", function() {
    popup.style.display = "none";
    popupVideo.pause();
    popupVideo.querySelector("source").src = "";
    popupVideo.load();
  });

});
</script>



{% schema %}
{
  "name": "Video Carousel Banner",
  "settings": [
    { "type": "text", "id": "custom_class", "label": "Custom CSS Class" },

    { "type": "image_picker", "id": "bg_image", "label": "Background Image" },
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#ffffff" },

    { "type": "text", "id": "subheading", "label": "Subheading" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Video Carousel" },
    { "type": "textarea", "id": "description", "label": "Description" },

    { "type": "range", "id": "padding_top_desktop", "label": "Padding Top Desktop", "default": 80, "min": 0, "max": 100, "step": 1 },
    { "type": "range", "id": "padding_bottom_desktop", "label": "Padding Bottom Desktop", "default": 80, "min": 0, "max": 100, "step": 1 },

    { "type": "range", "id": "padding_top_mobile", "label": "Padding Top Mobile", "default": 40, "min": 0, "max": 100, "step": 1 },
    { "type": "range", "id": "padding_bottom_mobile", "label": "Padding Bottom Mobile", "default": 40, "min": 0, "max": 100, "step": 1 }
  ],

  "blocks": [
    {
      "type": "video",
      "name": "Video Card",
      "settings": [
        { "type": "text", "id": "title", "label": "Title" },
        { "type": "textarea", "id": "description", "label": "Description" },
        {
        "type": "video",
            "id": "video_file",
            "label": "Upload Video (MP4 recommended)"
        }
      ]
    }
  ],

  "presets": [
    { "name": "Video Carousel Banner" }
  ]
}
{% endschema %}
