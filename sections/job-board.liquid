{% style %}
#job-board-{{ section.id }} {
  padding-top: {{ section.settings.padding_top_desktop }}px;
  padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
}

@media (max-width: 767px) {
  #job-board-{{ section.id }} {
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }
}

.job_board_container {
  display: grid;
  grid-template-columns: 1fr 3fr;
  gap: 30px;
}

.job_board_sidebar {
  position: sticky;
  top: 150px;
  height: fit-content;
}

.job_listing_title li {
  list-style: none;
  cursor: pointer;
  padding: 8px 5px;
}

.job_listing_title li.active {
  font-weight: bold;
  color: #000;
}
{% endstyle %}

<section id="job-board-{{ section.id }}" class="job-board-section {{ section.settings.custom_class }}">
  <div class="{{ section.settings.container_width }}">
    <div class="job_board_container">

      <!-- Sidebar -->
      <div class="job_board_sidebar">
        <div class="sidebar_header">
          <h5>All jobs Portal</h5>
        </div>

        <div class="sidebar_content">
          <div class="job_listing_title">
            {% for block in section.blocks %}
              {% if block.type == 'team' %}
                <li 
                  class="{% if forloop.first %}active{% endif %}" 
                  data-title="{{ block.settings.team_id }}">
                  {{ block.settings.team_name }}
                </li>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="job_board_content">

        <!-- Search -->
        <div class="job_search_wrapper" style="margin-bottom: 20px;">
          <input type="text" id="jobSearch" placeholder="Search jobs..." 
            style="width: 100%; padding: 10px; font-size: 16px;">
        </div>

        <!-- Teams + Jobs -->
        <div class="all_jobs_block">

          {% for team in section.blocks %}
            {% if team.type == "team" %}

              <div class="job_box" data-box="{{ team.settings.team_id }}">
                <h2>{{ team.settings.team_name }}</h2>

                <div class="jobx_list">

                  {% for job in section.blocks %}
                    {% if job.type == "job" and job.settings.team_id == team.settings.team_id %}

                      <div class="job">
                        <div class="job_info">
                          <h5>{{ job.settings.job_title }}</h5>
                          <span class="location">{{ job.settings.location }}</span>
                        </div>
                        <a href="{{ job.settings.apply_link }}" class="btn">Apply Now</a>
                      </div>

                    {% endif %}
                  {% endfor %}

                </div>
              </div>

            {% endif %}
          {% endfor %}

        </div>
      </div>
    </div>
  </div>
</section>

<!-- Sidebar Scroll Script -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const items = document.querySelectorAll(".job_listing_title li");

  items.forEach(item => {
    item.addEventListener("click", function () {
      const target = this.getAttribute("data-title");

      items.forEach(i => i.classList.remove("active"));
      this.classList.add("active");

      const box = document.querySelector(`.job_box[data-box="${target}"]`);
      if (box) {
        window.scrollTo({
          top: box.offsetTop - 150,
          behavior: "smooth"
        });
      }
    });
  });
});
</script>

<!-- Search Filter Script -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  const searchInput = document.getElementById("jobSearch");
  const jobBoxes = document.querySelectorAll(".job_box");

  searchInput.addEventListener("input", function () {
    const query = this.value.toLowerCase().trim();

    jobBoxes.forEach(box => {
      const jobs = box.querySelectorAll(".job");
      let boxHasMatch = false;

      jobs.forEach(job => {
        const title = job.querySelector("h5").textContent.toLowerCase();
        const location = job.querySelector(".location").textContent.toLowerCase();

        const matches = title.includes(query) || location.includes(query);

        if (matches || query === "") {
          job.style.display = "flex";
          boxHasMatch = true;
        } else {
          job.style.display = "none";
        }
      });

      box.style.display = boxHasMatch || query === "" ? "block" : "none";
    });
  });
});
</script>

{% schema %}
{
  "name": "Job Board",
  "settings": [
    { "type": "text", "id": "custom_class", "label": "Custom CSS Class" },

    { "type": "header", "content": "Padding Settings" },

    {
      "type": "range",
      "id": "padding_top_desktop",
      "min": 0, "max": 200, "step": 2, "unit": "px",
      "label": "Padding Top (desktop)",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "min": 0, "max": 200, "step": 2, "unit": "px",
      "label": "Padding Bottom (desktop)",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0, "max": 200, "step": 2, "unit": "px",
      "label": "Padding Top (mobile)",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0, "max": 200, "step": 2, "unit": "px",
      "label": "Padding Bottom (mobile)",
      "default": 40
    },

    {
      "type": "select",
      "id": "container_width",
      "label": "Container Width",
      "default": "page-width",
      "options": [
        { "label": "Container", "value": "page-width" },
        { "label": "Full Width", "value": "full-width" }
      ]
    }
  ],

  "blocks": [
    {
      "type": "team",
      "name": "Team",
      "settings": [
        { "type": "text", "id": "team_name", "label": "Team Name" },
        { "type": "text", "id": "team_id", "label": "Team ID (ex: atlanta-braves)" }
      ]
    },

    {
      "type": "job",
      "name": "Job",
      "settings": [
        { "type": "text", "id": "job_title", "label": "Job Title" },
        { "type": "text", "id": "location", "label": "Location" },
        { "type": "url", "id": "apply_link", "label": "Apply Link" },
        { "type": "text", "id": "team_id", "label": "Team ID (must match a Team blockâ€™s team_id)" }
      ]
    }
  ],

  "presets": [
    { "name": "Job Board" }
  ]
}
{% endschema %}
